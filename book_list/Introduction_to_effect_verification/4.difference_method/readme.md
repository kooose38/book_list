# 差分の差分法

## 概要
- ある時期から介入を初めて、その開始前後での比較で効果を考える分析方法。
- 時間軸にしたがってあるタイミングから、介入を行う場合、その前後の比較のみでは過去と現在の差が介入のみが目的変数に作用しているとは考えらない。つまり、介入以外の同時期に影響を与えたような共変量が存在するかもしれない。
- 上記より、ある地域間の介入前後だけでなくほかの地域の介入前後のデータを使用して、ある地域の効果量をセレクションバイアスを考慮して効果量を推定する。


## 差分の差分法：DID
- 介入されたグループと非介入グループの前後における効果量の差分を求める。その求めたそれぞれの差分のさらに差分を取り、介入された効果量を推定する。
- 以下2点を考慮した方法といえる。
    - 一回目の差分によって、地域間（介入・非介入グループによる目的変数に与える地域間の違いなど）のセレクションバイアスを除く
    - 二回目の差分によって、同地域間での時間差によるセレクションバイアスを除く
- ただし、使用する際には介入がなかった場合の介入（現実的に観測されていない）・非介入グループの目的変数の推移が一定の関係（平行トレンド仮定）であることが仮定される。介入までの期間がある程度得られるデータにおいて、介入・非介入のトレンドが似ているか確認することで、検証することができる。
- 平行トレンド仮定が成り立たない場合の対象法として以下２点がある。
    - 介入グループの目的変数の推移に近似した非介入グループのみ使用する。例としては、ある介入グループにおける地域と近隣の地域を非介入グループとして使用するなど。
    - トレンドの乖離を説明できる共変量をモデルに加える。ただし分析者が目的変数の背後に潜む成り立ちを熟知する必要があり難度が高い。

## CuasualInpact
- まずDIDでは以下２点の問題がある。
    - 非介入グループのデータが必要。介入を行ったデータしか手に入らない場合に使用できない。
    - 分析者の仮定に依存してしまう。特に平行トレンド仮定の背景を知り、データ加工するのに様々な仮定が必要となる。
- 上記２点を考慮した手法である。つまり、**介入のサンプルにおいて介入しなかった場合を推定**することで、効果量を求める方法といえる。
- 目的変数を予測できるような強い相関かつ、介入に影響されない（潜在的な）共変量が求められる。
- 介入グループにおける介入前のトレンドに類似した非介入グループが自動的に選ばれる。選択された非介入グループを用いて、介入がなかった場合の介入グループを推定する合成コントロールというアルゴリズムが内部で使われている。
- またDIDでは平均的な効果量しか得られないのに対して、時間に伴う効果量の推移を得られるメリットがある。（介入から１年後は〇％上昇し、2年後には△％の上昇があったなど）
